#!/usr/bin/env python
# coding:utf-8
# author:B1anda0

import requests,sys,colorama
from colorama import *
init(autoreset=True)


banner='''\033[1;33;40m
  _______      ________    ___   ___ ___  __      ___  __  ___ ______ ___  
 / ____\ \    / /  ____|  |__ \ / _ \__ \/_ |    |__ \/_ |/ _ \____  |__ \ 
| |     \ \  / /| |__ ______ ) | | | | ) || |______ ) || | (_) |  / /   ) |
| |      \ \/ / |  __|______/ /| | | |/ / | |______/ / | |\__, | / /   / / 
| |____   \  /  | |____    / /_| |_| / /_ | |     / /_ | |  / / / /   / /_ 
 \_____|   \/   |______|  |____|\___/____||_|    |____||_| /_/ /_/   |____|
                                                                                                                                                                                                                            
'''


def verify():
	headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36"}
	path1= '/ui/vropspluginui/rest/services/uploadova'
	path2='/ui/vropspluginui/rest/services/getstatus'
	poc1=urls+path1
	poc2=urls+path2
	try:
		requests.packages.urllib3.disable_warnings() #解决InsecureRequestWarning警告
		response1=requests.get(poc1,headers=headers,timeout=15,verify=False)
		response2=requests.get(poc2,headers=headers,timeout=15,verify=False)
		if  response1.status_code==405 and (response2.status_code==200 and "States" and "Install Progress" in response2.content):
			print(u'\033[1;31;40m[+]{} is vmware vcenter unauthorized rce vulnerability'.format(urls))
			#将漏洞地址输出在Vul.txt中
			f=open('./vul.txt','a')
			f.write(urls)
			f.write('\n')
		else:
			print('\033[1;32;40m[-]{} None'.format(urls))
	except:
		print('{} request timeout'.format(urls))


if __name__ == '__main__':
	print (banner)
	if len(sys.argv)!=2:
		print('Example:python CVE-2021-21972.py urls.txt')
	else:
		file = open(sys.argv[1])
		for url in file.readlines():
			urls=url.strip()
			if urls[-1]=='/':
				urls=urls[:-1]
			verify()
		print ('Check Over')
